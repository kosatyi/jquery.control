!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).jqctrl={})}(this,(function(t){"use strict";const e=window.jQuery;function n(t){return Array.isArray(t)}function i(t){return"function"==typeof t}function r(t){return!1!=("object"===function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}(t))&&(t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype)}function s(t,e,n){let i,r=n||e;for(i in t)t.hasOwnProperty(i)&&e.call(r,t[i],i)}function o(t){let e,n=[];return t=(t=t.concat("/?")).replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,(function(t,e,i,r,s,o){return n.push({name:r,optional:!!o}),e=e||"",(o?"":e)+"(?:"+(o?e:"")+(i||"")+(s||i&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")})).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)").replace(/@num/g,"\\d+").replace(/@word/g,"\\w+"),e=new RegExp("^"+t+"$",""),e.keys=n,e}function a(t,e){let n,i=t.exec(e),r={};if(!i)return!1;for(let e=1,s=i.length;e<s;++e)(n=t.keys[e-1])&&(r[n.name]="string"==typeof i[e]?decodeURIComponent(i[e]):i[e]);return r}const c={},l={value:!1},h=function(t,e,n){const i=function(t,e){const n=[null];return n.push.apply(n,e),Function.bind.apply(t,n)}(t,e),r=new i;return n&&function(t,e){const n=Object.setPrototypeOf?Object.setPrototypeOf.bind(null):function(t,e){return t.__proto__=e,t};n(t,e)}(r,n.prototype),r},u=function(t,e,n){return function(){let i,r=this._super;return this._super=t[e],i=n.apply(this,arguments),this._super=r,i}},p=function(){};function f(t,e,n){return c[t]||(c[t]=(n?c[e]:p).extend(n||e,t)),c[t]}function d(t,e){return"function"!=typeof c[t]?null:new c[t](e)}function _(t,e,n){let i={},r={true:!0,false:!1,null:null};return n&&(t=t.replace(/\+/g," ")),t.split("&").forEach((function(t){let n,s=t.split("="),o=decodeURIComponent(s[0]),a=i,c=0,l=o.split("]["),h=l.length-1;if(/\[/.test(l[0])&&/]$/.test(l[h])?(l[h]=l[h].replace(/]$/,""),l=l.shift().split("[").concat(l),h=l.length-1):h=0,2===s.length)if(n=decodeURIComponent(s[1]),e&&(n=n&&!isNaN(n)&&+n+""===n?+n:"undefined"===n?void 0:void 0!==r[n]?r[n]:n),h)for(;c<=h;c++)o=""===l[c]?a.length:l[c],a=a[o]=c<h?a[o]||(l[c+1]&&isNaN(l[c+1])?{}:[]):n;else"[object Array]"===Object.prototype.toString.call(i[o])?i[o].push(n):!{}.hasOwnProperty.call(i,o)?i[o]=n:i[o]=[i[o],n];else o&&(i[o]=e?void 0:"")})),i}p.prototype={_super(){},instance(){return h(this.constructor,arguments)},proxy(t){return t="string"==typeof t?this[t]:t,e=this,n=t,function(){return n.apply(e,[this].concat([].slice.call(arguments)))};var e,n}},p.extend=function t(e,n){function r(){!l.value&&this.init&&this.init.apply(this,arguments)}return r.prototype=function(t,e){let n,r,s=t.prototype;for(n in l.value=!0,r=new t,l.value=!1,e)e.hasOwnProperty(n)&&(i(s[n])&&i(e[n])&&~e[n].toString().indexOf("this._super(")?r[n]=u(s,n,e[n]):r[n]=e[n]);return r}(this,e),r.prototype.$className=n,r.prototype.constructor=r,r.extend=t,r};const g=/[^\[\]]+|\[\]$/g;function y(t){let e;for(e in t)t.hasOwnProperty(e)&&(0===t[e].length?(n(t)&&t.splice(e,1),r(t)&&delete t[e]):"object"==typeof t[e]&&y(t[e]));return t}let m=!1;const b={prefix:"#",type:"hash",event:"hashchange",callbacks:[],initialize:!1,url:function(t,e){return location[!0===e?"replace":"assign"](t),this},getSilence:()=>m,setSilence(t){return m=Boolean(t),this},normalize(t){let e=String(this.prefix);return(0===t.indexOf("http")||0===t.indexOf(e))&&(e=""),[e,t].join("")},assign(t,e){return this.setSilence(e).url(this.normalize(t),!1)},replace(t,e){return this.setSilence(e).url(this.normalize(t),!0)},route(t,e){const n=this.normalize(t);return this.href()!==n?this.setSilence(e).url(n,!1):this.reload()},reload(){return this.setSilence(!1).change()},origin:()=>location.origin,host:()=>location.host,href(){return location[this.type].slice(1)},indexOf(t,e){return this.href().indexOf(t)===e},part(t){return this.href().split("#")[0].split("?")[t]||""},query(t,e,n){if(!arguments.length)return _(this.part(1));t=t?[this.part(0),$.param(t)].join("?"):this.part(0),this[e?"replace":"assign"](t,n)},path(t,e,n){if(!arguments.length)return this.part(0);t=this.part(1)?[t,this.part(1)].join("?"):t||"/",this[e?"replace":"assign"](t,n)},json(t,e,n){let i=this.href().split("#")[0].split("?")[1]||"{}";if(!arguments.length){try{i=decodeURIComponent(i),i=JSON.parse(i)}catch(t){i={}}return i}t=t?[this.part(0),JSON.stringify(t)].join("?"):this.part(0),this[e?"replace":"assign"](t,n)},bind(t){this.callbacks.push(t),this.changeHandler=this.changeHandler||this.change.bind(this),!1===this.initialize&&(window.addEventListener(this.event,this.changeHandler),this.initialize=!0)},unbind(t){this.callbacks.splice(this.callbacks.indexOf(t),1)},change(){if(this.getSilence())return this.setSilence(!1);if(this.callbacks.length)for(const t in this.callbacks)this.callbacks.hasOwnProperty(t)&&this.callbacks[t].call(this);return this}},x={},w=p.extend({forEach:s,init(t){this.extend(t)},extend(t){this.$data=t||{}},alt(t,e){return null==(t=this.attr(t))||""===t?e:t},defer:()=>e.Deferred(),resolve(){return this.defer().resolve(this)},attr(t,e){const n=arguments.length>1,i=t.split("."),r=i.pop(),s=i.reduce(((t,e)=>t&&t[e]&&t[e].$data?t[e].$data:(n&&(null!==t[e]&&"object"==typeof t[e]||(t[e]={})),t?t[e]:void 0)),this.$data);return n?(s[r]=e,this):s?s[r]:void 0},eachItem(t){let e=t[1]?t[0]:null,i=t[1]?t[1]:t[0],r=e?this.alt(e,[]):this.$data;return{value:(s=r,Object.keys(s).sort().reduce((function(t,e){return t[e]=s[e],t}),{})),isArray:n(r),callback:i};var s},each(){let t=this.eachItem(arguments);this.forEach(t.value,(function(e,n){t.callback(this.instance(e),e,n)}),this)},serialize(){const t=this;return function e(s){const o=n(s)?[]:{};for(let a in s)if(s.hasOwnProperty(a)){let c=s[a];if(c===t)continue;c&&i(c.serialize)?o[a]=c.serialize():n(c)||r(c)?o[a]=e(c):o[a]=c}return o}(this.$data)},stringify:function(){return JSON.stringify(this.serialize())}});function v(t,e,n){return x[t]||(x[t]=(n?x[e]:w).extend(n||e,t)),x[t]}function j(t,e){if("function"==typeof x[t])return new x[t](e)}const O={hashchange(t){b.bind((function(){t(b.path())})),""===b.part(0)?b.assign("/"):t(b.path())}};v("router.queue",{init(t){this.callbacks=[],this.response=t,this.reset()},reset(){this.list={},this.callbacks.length=0},has(t){return this.list.hasOwnProperty(t)},empty(){return 0===Object.keys(this.list).length},complete(t,e){this.remove(t),this.response.attr(t,e),this.empty()&&this.callbacks.forEach((t=>{this.callbacks.splice(this.callbacks.indexOf(t),1),t()}))},remove(t){return this.has(t)&&delete this.list[t],this},then(t){return this.empty()?t():this.callbacks.push(t),this},stop(){Object.keys(this.list).forEach((t=>{this.remove(t)})),this.list={},this.callbacks.length=0},notify(t,e){this.has(t)&&this.complete(t,e)},add(t,e){return this.list[t]=e.then((e=>{this.notify(t,e)}),(()=>{this.notify(t)})),this}}),v("router.response",{init(t){this.extend(t),this.defer=j("router.queue",this)},queue(t,e){return this.defer.add(t,e),this},then(t){return this.defer.then(t),this},stop(){return this.defer.stop(),this},render(t,e,n){console.info("render function call",t,e,n)}}),v("router.request",{query(){let t=b.query();return this.attr("query",t),t},match(t){return new RegExp(t).test(this.attr("path"))},model(){let t=[].slice.call(arguments),e=t.shift(),n=t.shift(),i=j(e);return n&&"function"==typeof i[n]?i[n].apply(i,t):i},getChildPath(){return"/".concat(this.alt("params._path_",""))},path(t){this.attr("path",t)},params(t){t=Object.assign({},this.alt("parent",{}),t||{}),this.attr("params",t),this.attr("parent",t)}}),f("route",{init(t){this.params={},this.callbacks=[],this.name=t,this.regex=o(t)},then(t){return this.callbacks.push(t),this},match(t){return this.path=t,this.params=a(this.regex,this.path),!!this.params},getCallbacks(){return this.callbacks}});const k=f("router",{init(){this._before_=[],this._after_=[],this._routes_={},this.request=j("router.request"),this.response=j("router.response")},prepare(){this.request.attr("path",""),this.request.attr("params",{}),this.request.attr("parent",{}),this.response.attr("data",{}),this.response.stop()},route(t){let e=this._routes_[t]||d("route",t);return this._routes_[t]=e,e},use(t){return this.route(t.concat("/",":_path_(*)?"))},before(t){return this._before_.push(t),this},after(t){return this._after_.push(t),this},call(t,e,n,i){this.request=e,this.response=n,this.find(this.request.getChildPath(),i)},apply(t,e){this.call(t,e[0],e[1],e[2])},process(t,e){!function n(i,r){let s=[];if(!1===(t[r]||!1))return e&&e.call&&e.call(i);s.push(i.request),s.push(i.response),s.push((function(){i.response.then((function(){n(i,++r)}))})),t[r].apply(i,s)}(this,0)},start(t,e){this.request.path(t.path),this.request.params(t.params),this.request.query(),this.process(this._before_,(function(){this.process(t.getCallbacks(),(function(){this.process(this._after_,e)}))}))},find(t,e){let n,i=d("route",t);for(n in!0===e&&this.prepare(),this._routes_)if(this._routes_.hasOwnProperty(n)&&(n=this._routes_[n],n.match(t))){i=n;break}this.start(i,e)},listen(t){var e;return"string"==typeof t&&"function"==typeof O[t]&&(t=O[t]),t((e=this,function(t){e.find(t,!0)})),this}}),S={},C=[],E="control",q="["+E+"]",P=p.extend({window:e(window),document:e(document),_addProxy_(t,e,n){return n.length===t&&(n[t-1]=this.proxy(n[t-1])),n.length===e&&(n[e-1]=this.proxy(n[e-1])),n},_event_(t,e){let n=this.toArray(e);return n=this._addProxy_(2,3,n),this.element[t].apply(this.element,n),this},init(t){this.pushInstance(),this.initElement(t),this.create(t)},pushInstance(){C.push(this)},initElement(t){this.element=e(t)},create(t){},toArray:t=>Array.prototype.slice.call(t),initBindings(){this._bindings_||(this._bindings_=[])},addBinding(t){this.initBindings(),this._bindings_.push([].concat(t))},proxy(t){return this._proxy_cache_||(this._proxy_cache_={}),this._proxy_cache_[t]||(this._proxy_cache_[t]=this._super(t)),this._proxy_cache_[t]},find(){return this.element.find.apply(this.element,arguments)},el(t,n,i){const r=e(document.createElement(t));return n&&r.addClass(n),i&&r.attr(i),r},clearProxyCache(){s(this._proxy_cache_,(function(t,e){delete this._proxy_cache_[e]}),this)},bind(){let t=this.toArray(arguments);this.addBinding(t),t=this._addProxy_(3,4,t);let n=this[t[0]]||e(t[0]);return n.on.apply(n,t.slice(1)),this},unbind(){let t=this.toArray(arguments);this.initBindings(),this._bindings_=this._bindings_.filter((e=>!1===function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(e,t))),t=this._addProxy_(3,4,t);let n=this[t[0]]||e(t[0]);return n.off.apply(n,t.slice(1)),this},unbindAll(){return this.initBindings(),this._bindings_.forEach((function(t){this.unbind.apply(this,t)}),this),this._bindings_=[],this},on(){return this._event_("on",arguments),this},off(){return this._event_("off",arguments),this},trigger(t){const n=this.toArray(arguments).slice(1),i=e.Event(t);return this.element.trigger.apply(this.element,[i].concat(n)),i},delay(t,e){const n=[t=this.proxy(t,!0),e].concat(Array.from(arguments).slice(2));this._delay_map_||(this._delay_map_=new WeakMap),this._delay_set_||(this._delay_set_=new Set),this._delay_map_.has(t)&&clearTimeout(this._delay_map_.get(t));const i=setTimeout.apply(null,n);return this._delay_set_.add(i),this._delay_map_.set(t,i),this},clearDelayList(){if(!this._delay_set_)return!0;this._delay_set_.forEach((t=>{clearTimeout(t)})),this._delay_set_=null,this._delay_map_=null},destroy(){this.off(),this.unbindAll(),this.clearProxyCache(),this.clearDelayList(),this.element.removeData()},canBeDestroyed(){return!1===e.contains(document,this.element.get(0))}});function A(t,e){let n=t.querySelectorAll(q).length,i=e.querySelectorAll(q).length;return n&&!i||n>i?1:!n&&i||n<i?-1:0}function I(t){C.forEach((function(e,n){(e.canBeDestroyed()||t)&&(e.destroy(),C.splice(n,1))}))}function M(t,e,n){return S[t]?(console.info("control with name [%s] is already exist",t),S[t]):(S[t]=(n?S[e]:P).extend(n||e,t),S[t])}function R(t){const e=[].slice.call(arguments,1);if("function"==typeof S[t])return h(S[t],e)}const T={},z={},N={},D={},L={},B=/<%([\s\S]+?)%>/g,H=/<%=([\s\S]+?)%>/g,F=/<%-([\s\S]+?)%>/g,U=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},Q=/[\\'\r\n\t\u2028\u2029]/g,W={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},Z=new RegExp("[&<>\"']","g"),G=function(t,e,n){let i,r=n||e;for(i in t)t.hasOwnProperty(i)&&e.call(r,t[i],i)},K=function(t,e){return(t||"").replace(/{(.+?)}/g,(function(t,n){return void 0!==e[n]?e[n]:t}))},V=function(t){let e=1e6,n=String(e).length-1,i=Math.abs(Math.random())*e,r=String((new Date).getTime()).match(/.{1,7}/g),s=parseFloat(String(i)).toFixed(n).split(".");return[t].concat(s).concat(r).join("-")},X=function(t){return null==t?"":(""+t).replace(Z,(function(t){return W[t]}))},Y=function(t,e){let n,i=new RegExp([(F||U).source,(H||U).source,(B||U).source].join("|")+"|$","g"),r=0,s="__p+='";(t||"").replace(i,(function(e,n,i,o,a){var c;return s+=null==(c=t.slice(r,a))?"":(""+c).replace(Q,(function(t){return"\\"+J[t]})),n&&(s+="'\n+((__t=("+n+"))==null?'':escapeExpr(__t))+\n'"),i&&(s+="'\n+((__t=("+i+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+";\n__p+='"),r=a+e.length,e})),s+="';",s="with(obj||{}){\n"+s+"}",s="var __t,__p='',__j=[].join,print=function(){__p+=__j.call(arguments,'');};"+s+"return __p;\n//# sourceURL=["+e+"]";try{n=new Function("obj","escapeExpr",s)}catch(t){console.error(t)}let o=function(t){let e="";try{e=n&&n.call(this,t,X)}catch(t){console.error(t)}return e};return o.source="function(obj){"+s+"}",o},tt=p.extend({init:function(t,e){this.source=it.source(t),this.compile(this.source,e)},compile:function(t,e){return this.output=Y(t,e),this},renderHTML:function(t){return t=this.extend(t),this.output.call(t,t)},render:function(t){let e=function(t){let e=document.createElement("template");if("content"in e)return e.innerHTML=t,document.importNode(e.content,!0);let n=document.createDocumentFragment(),i=document.createElement("div");for(i.innerHTML=t;i.firstChild;)n.appendChild(i.firstChild);return n}(this.renderHTML(t));return function(t){G(N,(function(e,n,i,r){if(null===(i=t.getElementById(n)))return!1;r=document.createElement(e.tag),i.parentNode&&i.parentNode.replaceChild(r,i),"function"==typeof e.callback&&e.callback(r),delete N[n]}))}(e),function(t){G(D,(function(e,n){let i=t.querySelector(e.selector);null!==i&&(i.removeAttribute(n),"function"==typeof e.callback&&e.callback(i),delete D[n])}))}(e),e},extend:function(t){return e.extend({},this,t||{},rt)}}),et=["ejs","html","svg","css","js"],nt=function(t){return new RegExp("^(.+)(\\.)("+t.join("|")+")$")},it={ext:et,exp:nt(et),set:function(t){this.ext=t,this.exp=nt(t)},name:function(t){return String(t).replace(this.exp,"$1")},get:function(t){let e=0,n=!1,i=this.ext,r=z,s=this.name(t);for(;e<i.length&&(n=r[[s,i[e]].join(".")],!n);e++);return n},source:function(t){return this.get(t)||t}},rt={$include:function(t,e){return st(K(t,this)).renderHTML(e)},$each:function(t,e,n){G(t,e,n)},$view:function(t,e){let n=V("node");return N[n]={tag:t,callback:e},K('<view id="{0}"></view>',[n])},$prop:function(t){let e=V("attr");return D[e]={selector:["[",e,"]"].join(""),callback:t},["",e,""].join(" ")},$control:function(t,e,n){return this.$view(t,(function(t){R(e,t)}))}};function st(t){return L[t]||(L[t]=new tt(t)),L[t]}function ot(){}st.resolver=it,st.preload=function(t){return T[t]=T[t]||e.get(t).then((function(t){e.extend(z,t)})),T[t]},st.helper=function(t,e){rt[t]=e},ot.prototype={getItem:function(t){return this[t]},setItem:function(t,e){this[t]=e},removeItem:function(t){delete this[t]},clear:function(){for(let t in this)this.hasOwnProperty(t)&&delete this[t]}};const at=new ot,ct="localStorage"in window&&window.localStorage?window.localStorage:at,lt={storageProvider:ct,set:function(t,e,n){n=(new Date).getTime()+1e3*n*60;try{ct.setItem(["cache",t,"ttl"].join(":"),n),ct.setItem(["cache",t].join(":"),JSON.stringify(e))}catch(t){ct.clear()}return this},expire:function(t){return ct.removeItem(["cache",t,"ttl"].join(":")),ct.removeItem(["cache",t].join(":")),this},exist:function(t){let e=Storage.getItem(["cache",t,"ttl"].join(":"));return!!(e&&e>(new Date).getTime())},get:function(t){return JSON.parse(Storage.getItem(["cache",t].join(":")))},list:function(){let t,e=[];for(t in ct)ct.hasOwnProperty(t)&&-1!==t.indexOf("cache:")&&-1===t.indexOf(":ttl")&&e.push(t.slice(6));return e},clear:function(t){this.list().forEach(function(e){(!0===t||!1===this.exist(e))&&this.expire(e)}.bind(this))}};e.StorageCache=lt,e.Class=p,e.Model=w,e.Control=P,e.Router=k,e.createClass=f,e.getClass=d,e.createModel=v,e.getModel=j,e.createControl=M,e.initControl=R,e.cleanControls=I,e.location=b,e.deparam=_,e.ejs=st,e.fn.setFormData=function(t){return this.find("[name]").each(((e,i)=>{let r=this.find(i),s=r.attr("name").match(g),o=function(t,e){let n=0,i=(e||"").split("."),r=i.pop();for(;n<i.length&&t&&t.hasOwnProperty(i[n]);n++)t=t[i[n]];return t?t[r]:null}(t,s.join("."));o&&(r.is(":radio")?r.val()===o&&r.attr("checked",!0):r.is(":checkbox")?(o=n(o)?o:[o],o.indexOf(r.val())>-1&&r.attr("checked",!0)):r.val(o))})),this},e.fn.getFormData=function(t,e){let n=_(this.serializeArray().map((t=>[t.name,encodeURIComponent(t.value)].join("="))).join("&"),e,!1);return!0===t?y(n):n},e.fn.initControls=function(){this.each((function(t,e){!function(t){I(),Array.prototype.slice.call(t.querySelectorAll(q)).sort(A).forEach((function(t){t.getAttribute(E).split(",").forEach((function(e){R(e,t)})),t.removeAttribute(E)}))}(e)}))},t.$=e,t.Class=p,t.Control=P,t.Model=w,t.Router=k,t.StorageCache=lt,t.UrlLocation=b,t.cleanControls=I,t.createClass=f,t.createControl=M,t.createModel=v,t.deparam=_,t.getClass=d,t.getModel=j,t.initControl=R,t.pathMatch=a,t.pathToRegexp=o}));
//# sourceMappingURL=index.min.js.map
