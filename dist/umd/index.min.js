!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).jqctrl={})}(this,(function(t){"use strict";const e=window.jQuery;function i(t){return Array.isArray(t)}function n(t){return"function"==typeof t}function s(t){return!1!=("object"===function(t){return{}.toString.call(t).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}(t))&&(t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype)}function r(t,e,i){let n,s=i||e;for(n in t)t.hasOwnProperty(n)&&e.call(s,t[n],n)}function a(t){let e,i=[];return t=(t=t.concat("/?")).replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,(function(t,e,n,s,r,a){return i.push({name:s,optional:!!a}),e=e||"",(a?"":e)+"(?:"+(a?e:"")+(n||"")+(r||n&&"([^/.]+?)"||"([^/]+?)")+")"+(a||"")})).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)").replace(/@num/g,"\\d+").replace(/@word/g,"\\w+"),e=new RegExp("^"+t+"$",""),e.keys=i,e}function h(t,e){let i,n=t.exec(e),s={};if(!n)return!1;for(let e=1,r=n.length;e<r;++e)(i=t.keys[e-1])&&(s[i.name]="string"==typeof n[e]?decodeURIComponent(n[e]):n[e]);return s}const o={},l={value:!1},c=function(t,e,i){const n=function(t,e){const i=[null];return i.push.apply(i,e),Function.bind.apply(t,i)}(t,e),s=new n;return i&&function(t,e){const i=Object.setPrototypeOf?Object.setPrototypeOf.bind(null):function(t,e){return t.__proto__=e,t};i(t,e)}(s,i.prototype),s},u=function(t,e,i){return function(){let n,s=this._super;return this._super=t[e],n=i.apply(this,arguments),this._super=s,n}},p=function(){};function f(t,e,i){return o[t]||(o[t]=(i?o[e]:p).extend(i||e,t)),o[t]}function d(t,e){return"function"!=typeof o[t]?null:new o[t](e)}function _(t,e,i){let n={},s={true:!0,false:!1,null:null};return i&&(t=t.replace(/\+/g," ")),t.split("&").forEach((function(t){let i,r=t.split("="),a=decodeURIComponent(r[0]),h=n,o=0,l=a.split("]["),c=l.length-1;if(/\[/.test(l[0])&&/]$/.test(l[c])?(l[c]=l[c].replace(/]$/,""),l=l.shift().split("[").concat(l),c=l.length-1):c=0,2===r.length)if(i=decodeURIComponent(r[1]),e&&(i=i&&!isNaN(i)&&+i+""===i?+i:"undefined"===i?void 0:void 0!==s[i]?s[i]:i),c)for(;o<=c;o++)a=""===l[o]?h.length:l[o],h=h[a]=o<c?h[a]||(l[o+1]&&isNaN(l[o+1])?{}:[]):i;else"[object Array]"===Object.prototype.toString.call(n[a])?n[a].push(i):!{}.hasOwnProperty.call(n,a)?n[a]=i:n[a]=[n[a],i];else a&&(n[a]=e?void 0:"")})),n}p.prototype={_super(){},instance(){return c(this.constructor,arguments)},proxy(t){return t="string"==typeof t?this[t]:t,e=this,i=t,function(){return i.apply(e,[this].concat([].slice.call(arguments)))};var e,i}},p.extend=function t(e,i){function s(){!l.value&&this.init&&this.init.apply(this,arguments)}return s.prototype=function(t,e){let i,s,r=t.prototype;for(i in l.value=!0,s=new t,l.value=!1,e)e.hasOwnProperty(i)&&(n(r[i])&&n(e[i])&&~e[i].toString().indexOf("this._super(")?s[i]=u(r,i,e[i]):s[i]=e[i]);return s}(this,e),s.prototype.$className=i,s.prototype.constructor=s,s.extend=t,s};const y=/[^\[\]]+|\[\]$/g;function g(t){let e;for(e in t)t.hasOwnProperty(e)&&(0===t[e].length?(i(t)&&t.splice(e,1),s(t)&&delete t[e]):"object"==typeof t[e]&&g(t[e]));return t}let m=!1;const b={prefix:"#",type:"hash",event:"hashchange",callbacks:[],initialize:!1,url:function(t,e){return location[!0===e?"replace":"assign"](t),this},getSilence:()=>m,setSilence(t){return m=Boolean(t),this},normalize(t){let e=String(this.prefix);return(0===t.indexOf("http")||0===t.indexOf(e))&&(e=""),[e,t].join("")},assign(t,e){return this.setSilence(e).url(this.normalize(t),!1)},replace(t,e){return this.setSilence(e).url(this.normalize(t),!0)},route(t,e){const i=this.normalize(t);return this.href()!==i?this.setSilence(e).url(i,!1):this.reload()},reload(){return this.setSilence(!1).change()},origin:()=>location.origin,host:()=>location.host,href(){return location[this.type].slice(1)},indexOf(t,e){return this.href().indexOf(t)===e},part(t){return this.href().split("#")[0].split("?")[t]||""},query(t,e,i){if(!arguments.length)return _(this.part(1));t=t?[this.part(0),$.param(t)].join("?"):this.part(0),this[e?"replace":"assign"](t,i)},path(t,e,i){if(!arguments.length)return this.part(0);t=this.part(1)?[t,this.part(1)].join("?"):t||"/",this[e?"replace":"assign"](t,i)},json(t,e,i){let n=this.href().split("#")[0].split("?")[1]||"{}";if(!arguments.length){try{n=decodeURIComponent(n),n=JSON.parse(n)}catch(t){n={}}return n}t=t?[this.part(0),JSON.stringify(t)].join("?"):this.part(0),this[e?"replace":"assign"](t,i)},bind(t){this.callbacks.push(t),this.changeHandler=this.changeHandler||this.change.bind(this),!1===this.initialize&&(window.addEventListener(this.event,this.changeHandler),this.initialize=!0)},unbind(t){this.callbacks.splice(this.callbacks.indexOf(t),1)},change(){if(this.getSilence())return this.setSilence(!1);if(this.callbacks.length)for(const t in this.callbacks)this.callbacks.hasOwnProperty(t)&&this.callbacks[t].call(this);return this}},x={},O=p.extend({forEach:r,init(t){this.extend(t)},extend(t){this.$data=t||{}},alt(t,e){return null==(t=this.attr(t))||""===t?e:t},defer:()=>e.Deferred(),resolve(){return this.defer().resolve(this)},attr(t,e){const i=arguments.length>1,n=t.split("."),s=n.pop(),r=n.reduce(((t,e)=>t&&t[e]&&t[e].$data?t[e].$data:(i&&(null!==t[e]&&"object"==typeof t[e]||(t[e]={})),t?t[e]:void 0)),this.$data);return i?(r[s]=e,this):r?r[s]:void 0},eachItem(t){let e=t[1]?t[0]:null,n=t[1]?t[1]:t[0],s=e?this.alt(e,[]):this.$data;return{value:(r=s,Object.keys(r).sort().reduce((function(t,e){return t[e]=r[e],t}),{})),isArray:i(s),callback:n};var r},each(){let t=this.eachItem(arguments);this.forEach(t.value,(function(e,i){t.callback(this.instance(e),e,i)}),this)},serialize(){const t=this;return function e(r){const a=i(r)?[]:{};for(let h in r)if(r.hasOwnProperty(h)){let o=r[h];if(o===t)continue;o&&n(o.serialize)?a[h]=o.serialize():i(o)||s(o)?a[h]=e(o):a[h]=o}return a}(this.$data)},stringify:function(){return JSON.stringify(this.serialize())}});function k(t,e,i){return x[t]||(x[t]=(i?x[e]:O).extend(i||e,t)),x[t]}function v(t,e){if("function"==typeof x[t])return new x[t](e)}const w={hashchange(t){b.bind((function(){t(b.path())})),""===b.part(0)?b.assign("/"):t(b.path())}};k("router.queue",{init(t){this.callbacks=[],this.response=t,this.reset()},reset(){this.list={},this.callbacks.length=0},has(t){return this.list.hasOwnProperty(t)},empty(){return 0===Object.keys(this.list).length},complete(t,e){this.remove(t),this.response.attr(t,e),this.empty()&&this.callbacks.forEach((t=>{this.callbacks.splice(this.callbacks.indexOf(t),1),t()}))},remove(t){return this.has(t)&&delete this.list[t],this},then(t){return this.empty()?t():this.callbacks.push(t),this},stop(){Object.keys(this.list).forEach((t=>{this.remove(t)})),this.list={},this.callbacks.length=0},notify(t,e){this.has(t)&&this.complete(t,e)},add(t,e){return this.list[t]=e.then((e=>{this.notify(t,e)}),(()=>{this.notify(t)})),this}}),k("router.response",{init(t){this.extend(t),this.defer=v("router.queue",this)},queue(t,e){return this.defer.add(t,e),this},then(t){return this.defer.then(t),this},stop(){return this.defer.stop(),this},render(t,e,i){console.info("render function call",t,e,i)}}),k("router.request",{query(){let t=b.query();return this.attr("query",t),t},match(t){return new RegExp(t).test(this.attr("path"))},model(){let t=[].slice.call(arguments),e=t.shift(),i=t.shift(),n=v(e);return i&&"function"==typeof n[i]?n[i].apply(n,t):n},getChildPath(){return"/".concat(this.alt("params._path_",""))},path(t){this.attr("path",t)},params(t){t=Object.assign({},this.alt("parent",{}),t||{}),this.attr("params",t),this.attr("parent",t)}}),f("route",{init(t){this.params={},this.callbacks=[],this.name=t,this.regex=a(t)},then(t){return this.callbacks.push(t),this},match(t){return this.path=t,this.params=h(this.regex,this.path),!!this.params},getCallbacks(){return this.callbacks}});const j=f("router",{init(){this._before_=[],this._after_=[],this._routes_={},this.request=v("router.request"),this.response=v("router.response")},prepare(){this.request.attr("path",""),this.request.attr("params",{}),this.request.attr("parent",{}),this.response.attr("data",{}),this.response.stop()},route(t){let e=this._routes_[t]||d("route",t);return this._routes_[t]=e,e},use(t){return this.route(t.concat("/",":_path_(*)?"))},before(t){return this._before_.push(t),this},after(t){return this._after_.push(t),this},call(t,e,i,n){this.request=e,this.response=i,this.find(this.request.getChildPath(),n)},apply(t,e){this.call(t,e[0],e[1],e[2])},process(t,e){!function i(n,s){let r=[];if(!1===(t[s]||!1))return e&&e.call&&e.call(n);r.push(n.request),r.push(n.response),r.push((function(){n.response.then((function(){i(n,++s)}))})),t[s].apply(n,r)}(this,0)},start(t,e){this.request.path(t.path),this.request.params(t.params),this.request.query(),this.process(this._before_,(function(){this.process(t.getCallbacks(),(function(){this.process(this._after_,e)}))}))},find(t,e){let i,n=d("route",t);for(i in!0===e&&this.prepare(),this._routes_)if(this._routes_.hasOwnProperty(i)&&(i=this._routes_[i],i.match(t))){n=i;break}this.start(n,e)},listen(t){var e;return"string"==typeof t&&"function"==typeof w[t]&&(t=w[t]),t((e=this,function(t){e.find(t,!0)})),this}}),q={},A=[],C="control",P="["+C+"]",S=p.extend({window:e(window),document:e(document),_addProxy_(t,e,i){return i.length===t&&(i[t-1]=this.proxy(i[t-1])),i.length===e&&(i[e-1]=this.proxy(i[e-1])),i},_event_(t,e){let i=this.toArray(e);return i=this._addProxy_(2,3,i),this.element[t].apply(this.element,i),this},init(t){this.pushInstance(),this.initElement(t),this.create(t)},pushInstance(){A.push(this)},initElement(t){this.element=e(t)},create(t){},toArray:t=>Array.prototype.slice.call(t),initBindings(){this._bindings_||(this._bindings_=[])},addBinding(t){this.initBindings(),this._bindings_.push([].concat(t))},proxy(t){return this._proxy_cache_||(this._proxy_cache_={}),this._proxy_cache_[t]||(this._proxy_cache_[t]=this._super(t)),this._proxy_cache_[t]},find(){return this.element.find.apply(this.element,arguments)},el(t,i,n){const s=e(document.createElement(t));return i&&s.addClass(i),n&&s.attr(n),s},clearProxyCache(){r(this._proxy_cache_,(function(t,e){delete this._proxy_cache_[e]}),this)},bind(){let t=this.toArray(arguments);this.addBinding(t),t=this._addProxy_(3,4,t);let i=this[t[0]]||e(t[0]);return i.on.apply(i,t.slice(1)),this},unbind(){let t=this.toArray(arguments);this.initBindings(),this._bindings_=this._bindings_.filter((e=>!1===function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}(e,t))),t=this._addProxy_(3,4,t);let i=this[t[0]]||e(t[0]);return i.off.apply(i,t.slice(1)),this},unbindAll(){return this.initBindings(),this._bindings_.forEach((function(t){this.unbind.apply(this,t)}),this),this._bindings_=[],this},on(){return this._event_("on",arguments),this},off(){return this._event_("off",arguments),this},trigger(t){const i=this.toArray(arguments).slice(1),n=e.Event(t);return this.element.trigger.apply(this.element,[n].concat(i)),n},delay(t,e){const i=[t=this.proxy(t,!0),e].concat(Array.from(arguments).slice(2));this._delay_map_||(this._delay_map_=new WeakMap),this._delay_set_||(this._delay_set_=new Set),this._delay_map_.has(t)&&clearTimeout(this._delay_map_.get(t));const n=setTimeout.apply(null,i);return this._delay_set_.add(n),this._delay_map_.set(t,n),this},clearDelayList(){if(!this._delay_set_)return!0;this._delay_set_.forEach((t=>{clearTimeout(t)})),this._delay_set_=null,this._delay_map_=null},destroy(){this.off(),this.unbindAll(),this.clearProxyCache(),this.clearDelayList(),this.element.removeData()},canBeDestroyed(){return!1===document.contains(this.element.get(0))}});function E(t,e){let i=t.querySelectorAll(P).length,n=e.querySelectorAll(P).length;return i&&!n||i>n?1:!i&&n||i<n?-1:0}function z(t){A.forEach((function(e,i){(e.canBeDestroyed()||t)&&(e.destroy(),A.splice(i,1))}))}function B(t){const e=[].slice.call(arguments,1);if("function"==typeof q[t])return c(q[t],e)}e.fn.setFormData=function(t){return this.find("[name]").each(((e,n)=>{let s=this.find(n),r=s.attr("name").match(y),a=function(t,e){let i=0,n=(e||"").split("."),s=n.pop();for(;i<n.length&&t&&t.hasOwnProperty(n[i]);i++)t=t[n[i]];return t?t[s]:null}(t,r.join("."));a&&(s.is(":radio")?s.val()===a&&s.attr("checked",!0):s.is(":checkbox")?(a=i(a)?a:[a],a.indexOf(s.val())>-1&&s.attr("checked",!0)):s.val(a))})),this},e.fn.getFormData=function(t,e){let i=_(this.serializeArray().map((t=>[t.name,encodeURIComponent(t.value)].join("="))).join("&"),e,!1);return!0===t?g(i):i},e.fn.initControls=function(){this.each((function(t,e){!function(t){z(),Array.prototype.slice.call(t.querySelectorAll(P)).sort(E).forEach((function(t){t.getAttribute(C).split(",").forEach((function(e){B(e,t)})),t.removeAttribute(C)}))}(e)}))},t.$=e,t.Class=p,t.Control=S,t.Model=O,t.Router=j,t.UrlLocation=b,t.cleanControls=z,t.createClass=f,t.createControl=function(t,e,i){return q[t]?(console.info("control with name [%s] is already exist",t),q[t]):(q[t]=(i?q[e]:S).extend(i||e,t),q[t])},t.createModel=k,t.deparam=_,t.getClass=d,t.getModel=v,t.initControl=B,t.pathMatch=h,t.pathToRegexp=a}));
//# sourceMappingURL=index.min.js.map
